<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>기숙사의 파수꾼 : : : Tarzan</title>
        <!-- jQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

        <!-- Bulma -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css" />
    
        <!-- Font awesome -->
        <script defer src="https://use.fontawesome.com/releases/v6.4.0/js/all.js"></script>
        <script src="https://kit.fontawesome.com/eab63039c9.js" crossorigin="anonymous"></script>
    
        <!-- sans font -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet"><style>
        *{
          text-align: center;
          color : #48c78e;
          font-family: "Noto Sans KR", sans-serif;
        }
        html{
            overflow: auto;
        }
        .title{
          font-size: 10em;
        }
        section.hero.is-medium{
          position: relative;
        }
        section.hero.is-medium::before{
          content:"";
          background: white;
          border-radius: 10px;
          opacity:0.9;
          position:absolute;
          top:0px;
          left:0px;
          right:0px;
          bottom:0px;
        }
        body::before{
          content:"";
          background:url(/static/jungle.jpg) no-repeat;
          background-size:cover;
          opacity:0.5;
          position:absolute;
          top:0px;
          left:0px;
          right:0px;
          bottom:0px;
        }
        @media screen and (max-width: 600px) {
          .title{
            font-size: 3em;
          }
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script>
        $( document ).ready(function() {
          let id_regex = /^\d{2}-\d{1,3}$/;
            $("input[name='number']").on("input", function() {
              let numberValue = $(this).val();
              if(id_regex.test(numberValue)){
                $("#idWarning").text("ID 형식이 일치합니다.");
                $("#idWarning").removeClass("is-danger");
                $("#idWarning").addClass("is-success");
                $("input[name='number']").removeClass("is-danger");
                $("input[name='number']").addClass("is-success");
              }
              else{
                $("#idWarning").text("ID 형식이 불일치합니다.");
                $("#idWarning").removeClass("is-success");
                $("#idWarning").addClass("is-danger");
                $("input[name='number']").removeClass("is-success");
                $("input[name='number']").addClass("is-danger");
              }
            })

            
            $("#loginButton").click(function(){
                $("#loginButton").addClass('is-loading');

            })
        })
        function createCookie(value) {
      document.cookie = value;
    }

    function login() {
      let formData = $('#firstForm')

      $.ajax({
        type: "POST",
        url: "/login",
        data: formData.serialize(),
        success: function (response) {
          if (response['result'] == 'success') {
            alert('완료!')
            if (response['access_token']) {
              createCookie(response['access_token'])
              $.ajax({
                type: "POST",
                url: "/listAuth",
                beforeSend: function (xhr) {
                  xhr.setRequestHeader("Authorization", "Bearer " + document.cookie);
                },
                success: function (response) {
                  if (response['result'] == 'success') {
                    window.location.href = "http://localhost:33333/boardList" //서버주소로 수정해야 함!!!!!!!!!!!!!!!!!@@@@!!!!!!!
                  }
                  else {
                    alert("오류!")
                  }
                }
              })
            } else {
              alert('실패ㅠㅠ')
            }
          }
        }
      });

    }
    </script>
  </head>
  <body>
  <section class="section">
    <div class="container">
      <section class="hero is-medium">
        <!-- Hero content: will be in the middle -->
        <div class="hero-body">
          <div class="container has-text-centered">
            <p class="title has-text-success">
              Tarzan
            </p>
            <p class="subtitle has-text-success is-size-5 mt-1">
              기숙사 생활의 문제를 파수한다! <strong class="has-text-success">Tarzan</strong>!
            </p>
          </div>
        </div>
      </section>
      <form id="firstForm" method="post" class="columns is-three-fifths is-offset-one-fifth mt-3" action="/login">
        <div class="column is-three-fifths is-offset-one-fifth">
          <div class="columns field">
            <div class="field column">
              <label class="label">ID</label>
              <div class="control has-icons-left has-icons-right">
                <input name="number" class="input is-success" type="text" placeholder="ID 입력 예시) 기수-고유번호 : 5-18" value="">
                <span class="icon is-small is-left">
                  <i class="fas fa-user"></i>
                </span>
              </div>
              <p style="font-weight: bold; height: 40px;" id="idWarning" class="help is-danger"></p>
            </div>
            <div class="field column">
              <label class="label">PW</label>
              <div class="control has-icons-left has-icons-right">
                <input id="password" name="password" class="input is-success" type="password" placeholder="*******" value="">
                <span class="icon is-small is-left">
                  <i class="fa-solid fa-key"></i>
                </span>
              </div>
              <p style="font-weight: bold;" id="pwWarning" class="help is-danger"></p>
            </div>
          </div>
          <div class="columns is-mobile loButton mt-1">
            <button id="loginButton" class="column is-half is-offset-one-quarter button is-success is-size-4" >로그인</button>
          </div>
          <div style="text-align: right;"><a style="display: inline-block; color:black; font-weight: bold;" href="/addUser">회원가입</a></div>
        </div>
      </form>
    </div>
  </section>
</body>

</html>