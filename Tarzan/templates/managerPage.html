<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hello Tarzan!</title>
    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Bulma -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">

    <!-- Font awesome -->
    <script defer src="https://use.fontawesome.com/releases/v6.4.0/js/all.js"></script>
    <script src="https://kit.fontawesome.com/eab63039c9.js" crossorigin="anonymous"></script>

    <!-- sans font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">

    <style>
        * {
            text-align: center;
            box-sizing: border-box;
            font-family: "Noto Sans KR", sans-serif !important;
        }

        a {
            text-decoration: none;
            color: white;
        }

        html {
            overflow: auto;
        }

        #rightSection {
            border-radius: 10px 10px;
        }
        article{
            cursor: pointer;
        }
    </style>
    <script>
        $(document).ready(function () {
            $(".icon").css("color", "#f14668");
            document.getElementById("colorSelect").addEventListener("change", function () {
                changeColor(this);
            });           
            batchHouse();
            setInterval(() => batchHouse(), 30000);
        });
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = cookies[i].trim();
                    // 쿠키 이름으로 시작하는 쿠키를 찾음
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        function deleteCookie(name) {
            document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
        }
        function logout() {
            $.ajax({
                url: "/logout", // 요청을 보낼 엔드포인트 URL
                type: "POST", // 요청 메서드 (GET, POST, PUT, DELETE 등)
                headers: {
                    "Authorization": "Bearer " + getCookie("access_token") // JWT 토큰을 Authorization 헤더에 포함
                },
                success: function (response) {
                    alert(response.message);
                    window.location.href = '/';
                    deleteCookie("access_token");
                },
                error: function (xhr, status, error) {
                    // 요청이 실패한 경우 또는 오류가 발생한 경우
                    alert('인증 토큰 분실 및 서버 장애가 확인 됩니다. 관리자에게 문의하세요')
                    console.error("요청 실패 또는 오류 발생:", status, error);
                    window.location.href = '/';
                }
            });
        }
        function batchHouse() {
            $.ajax({
                url: "/batchHouse",
                type: "POST",
                headers: {
                    "Authorization": "Bearer " + getCookie("access_token") // JWT 토큰을 Authorization 헤더에 포함
                },
                success: function (response) {
                    $("#moniter").empty();
                    $("#moniter").prepend(response);
                },
                error: function (xhr, status, error) {
                    // 요청이 실패한 경우 또는 오류가 발생한 경우
                    alert('세션만료 및 서버 장애입니다. 재로그인 바랍니다.');
                    window.location.href = '/';
                }
            });
        }
        function closeModal(type) {
            switch (type) {
                case 1:
                    $(".modal.1").removeClass('is-active');
                    break;
                case 2:
                    $(".modal.2").removeClass('is-active');
                    break;
                case 3:
                    $(".modal.3").removeClass('is-active');
                    break;
                default:
                    break;
            }
        }
        function openModal(type) {
            switch (type) {
                case 1: // 호실별 문의 리스트 / 미완료 문의 리스트
                    $(".modal.1").addClass('is-active');
                    
                    break;
                case 2:
                    $(".modal.2").addClass('is-active');
                    break;
                case 3:
                    $(".modal.3").addClass('is-active');
                    break;
                default:
                    break;
            }

        }
        function changeColor(data) {
            let selectedColor = data.value; // 선택한 색상
            // 아이콘의 색상 변경
            switch (selectedColor) {
                case "미처리":
                    $(".icon").css("color", "#f14668");
                    break;
                case "진행중":
                    $(".icon").css("color", "#ffdd57");
                    break;
                case "완료":
                    $(".icon").css("color", "#48c774");
                    break;
                default:
                    $(".icon").css("color", "#f14668");
            }
        }
        function select_house(house_id) {
            let house = $('#house').val()       //id 값에 따라 #house값 변경
            $.ajax({
                type: 'POST',
                url: '/joinHouse',
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Authorization", "Bearer " + document.cookie);
                },
                data: { house: house_id },
                success: function (response) {
                    if (response['status'] == 'success') {
                        for (let i = 0; i < response.length; i++) {
                            grade = response[i]['grade']
                            number = response[i]['number']
                            name = response[i]['name']
                            inputHtml = '<h3>' + grade + ' ' + number + ' ' + nmae + '</h3>';
                            $('#house').append(inputHtml);          // 위와 동일
                        }
                    } else {
                        alert(response.message);
                    }
                }
            });
        }

         // 관리자 페이지 인원 리스트
         function select_house(house_id){
            let house = $('#house').val()       //id 값에 따라 #house값 변경
            $.ajax({
                type: 'POST',
                url: '/joinHouse',
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Authorization", "Bearer " + document.cookie);
                },
                data: {house:house_id},
                success: function(response) {
                    if (response['result'] == 'success') {
                        for(let i =0 ; i<response.length;i++){
                            grade = response[i]['grade']
                            number = response[i]['number']
                            name = response[i]['name']
                            inputHtml = '<h3>' + grade + ' ' + number + ' ' + name + '</h3>';
                            $('#house').append(inputHtml);          // 위와 동일
                        }
                    } else {
                        alert(response.message);
                    }
                }
            });
        }
        // 관리자 페이지 "호실 문의 리스트 확인"
        function help_list(house_id){
            let house = $('#user_list').val()       //id 값에 따라 #user_list값 변경
            $.ajax({
                type: 'POST',
                url: '/checkList',
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Authorization", "Bearer " + document.cookie);
                },
                data: {house:house_id},
                success: function(response) {
                    if (response['result'] == 'success') {
                        for(let i =0 ; i<response.length;i++){
                            house = response[i]['house']
                            state = response[i]['state']
                            title = response[i]['title']
                            date = response[i]['date']
                            name = response[i]['name']
                            inputHtml = '<h3>' + house + ' ' + state + ' ' + title + ' ' + name  +  ' ' + date +'</h3>';
                            $('#user_list').append(inputHtml);          // 위와 동일
                        }
                    } else {
                        alert(response.message);
                    }
                }
            });
        }

        // 관리자 페이지 "체크 인원 수정 처리"
        function modifyInformation(house_id, name_id, grade_id, number_id, new_name_id){
            let house = $('#user_information').val()       //id 값에 따라 #user_information값 변경
            $.ajax({
                type: 'POST',
                url: '/modifyUser',
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Authorization", "Bearer " + document.cookie);
                },
                data: {house: house_id,
                        name: name_id,
                        grade: grade_id,
                        number: number_id,
                        new_name: new_name_id},
                success: function(response) {
                    if (response['result'] == 'success') {
                        alert('수정이 완료되었습니다.');
                        window.location.reload();      
                    } else {
                        alert(response.message);
                    }
                }
            });
        }
        // 관리자 페이지 "체크 인원 퇴사 처리"
        function deleteInformation(house_id, name_id){
            let house = $('#user_information').val()       //id 값에 따라 #user_information값 변경
            $.ajax({
                type: 'POST',
                url: '/deleteUser',
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Authorization", "Bearer " + document.cookie);
                },
                data: {house: house_id,
                        name: name_id,
                    },
                success: function(response) {
                    if (response['result'] == 'success') {
                        alert('퇴사 처리가 완료되었습니다.');
                        window.location.reload();      
                    } else {
                        alert(response.message);
                    }
                }
            });
        }
    </script>
</head>

<body>
    <div class="title columns">
        <p class="column mt-4 has-text-success">
            기숙사 호실 문의 관리 시스템</p>
        <div class="column is-2 mt-3">
            <div class="columns">
                <button class="column button is-info" onclick="batchHouse()">페이지 새로고침</button>
                <button class="column button is-danger" onclick="logout()">로그아웃</button>
            </div>
        </div>
    </div>
    <div class="columns" >
        <section class="column section is-9" id="moniter"></section>
        <section id="rightSection" class="section column has-background-success">
            <div class="title">
                <p style="color:white; font-size:0.8em"><span style="color:white; font-size:1em">104</span>호실 인원 리스트</p>
            </div>
            <div class="box" style="position: relative; height: 30em;">
                <div class="box has-text-left">
                    <label class="radio">
                        <input type="radio" name="select">
                        <span>5-18 박덕기</span>
                    </label>
                </div>
                <div class="box has-text-left">
                    <label class="radio">
                        <input type="radio" name="select">
                        <span>5-17 XXX</span>
                    </label>
                </div>
                <div class="box has-text-left">
                    <label class="radio">
                        <input type="radio" name="select">
                        <span>5-17 XXX</span>
                    </label>
                </div>
                <div class="is-fullwidth" style="bottom: 5px;">
                    <button class="is-fullwidth button is-success mb-1" onclick="openModal(1)">호실 문의 리스트 확인</button>
                    <button class="is-fullwidth button is-info mb-1" onclick="openModal(2)">체크인원 수정 처리</button>
                    <button class="is-fullwidth button is-danger mb-1">체크인원 퇴사 처리</button>
                </div>
            </div>
            <button class="is-fullwidth button is-info mb-1" onclick="openModal(1)">미완료 문의 리스트</button>
            <button class="is-fullwidth button is-info mb-1" type="button"> <a href="./managerUserUpload.html">기숙사 인원
                    리스트 추가(EXCEL)</a></button>
        </section>
    </div>
    <div class="modal 1">
        <div class="modal-background"></div>
        <div class="modal-content" style="width: 80%;">
            <article class="message is-success">
                <div class="message-header">
                    <p style="color: white;">호실 문의 리스트 확인</p>
                </div>
                <div class="container" style="max-width: none; height: 601px; overflow: auto;">
                    <table class="table is-fullwidth">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>상태</th>
                                <th>제목</th>
                                <th>작성자</th>
                                <th>작성일</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td><span class="tag is-warning">진행중</span></td>
                                <td><a onclick="openModal(3)">첫 번째 게시물첫 번째 게시물첫 번째 게시물첫 번째 게시물</a></td>
                                <td>John Doe</td>
                                <td>2024-01-01</td>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td><span class="tag is-warning">진행중</span></td>
                                <td><a onclick="openModal(3)">첫 번째 게시물첫 번째 게시물첫 번째 게시물첫 번째 게시물</a></td>
                                <td>John Doe</td>
                                <td>2024-01-01</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <button class="is-fullwidth button is-danger" style="border-radius: 0;"
                    onclick="closeModal(1)">취소</button>
            </article>
        </div>
    </div>
    <div class="modal 2">
        <div class="modal-background"></div>
        <div class="modal-content" style="width: 80%;">
            <article class="message is-success">
                <div class="message-header">
                    <p style="color: white;">호실 문의 리스트 확인</p>
                </div>
                <form action="">
                    <div class="field">
                        <label class="label">기수</label>
                        <div class="control">
                            <input class="input" type="text" placeholder="Text input">
                        </div>
                    </div>
                    <div class="field">
                        <label class="label">학번</label>
                        <div class="control">
                            <input class="input" type="text" placeholder="Text input">
                        </div>
                    </div>
                    <div class="field">
                        <label class="label">이름</label>
                        <div class="control">
                            <input class="input" type="text" placeholder="Text input">
                        </div>
                    </div>
                </form>
                <button class="is-fullwidth button is-danger" style="border-radius: 0;"
                    onclick="closeModal(2)">취소</button>
            </article>
        </div>
    </div>
    <div class="modal 3">
        <div class="modal-background"></div>
        <div class="modal-content columns" style="width: 80%;">
            <article class="message is-success column" style="padding:0">
                <div class="message-header">
                    <p style="color: white;">문의 글 확인 및 수정</p>
                    <div class="control has-icons-left">
                        <div class="select">
                            <select id="colorSelect">
                                <option>미처리</option>
                                <option>진행중</option>
                                <option>완료</option>
                            </select>
                        </div>
                        <span class="icon is-medium is-left">
                            <i class="fa-solid fa-tag"></i>
                        </span>
                    </div>
                </div>
                <div class="message-header" style="border-radius: 0;">
                    <input class="input mb-2" type="text" placeholder="제목">
                </div>
                <div style="padding: 0 15px 15px; background-color: #48c774;">
                    <textarea style="min-height: 20em;" class="textarea is-success"
                        placeholder="본문 내용을 입력해주세요"></textarea>
                </div>
                <button class="is-fullwidth button is-info mb-1" style="border-radius: 0;">수정</button>
                <button class="is-fullwidth button is-danger" style="border-radius: 0;"
                    onclick="closeModal(3)">취소</button>
            </article>
            <section class="section column">
                <div class="container">
                    <div class="box" style="overflow: auto; max-height: 300px;">
                        <article class="media">
                            <div class="media-content">
                                <div class="content">
                                    <p>
                                        <strong>사용자 이름</strong>
                                        <br>
                                        댓글 내용 Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus nec
                                        iaculis mauris.
                                        <br>
                                        <small>작성일: 2024-03-19</small>
                                    </p>
                                </div>
                            </div>
                        </article>
                        <article class="media">
                            <div class="media-content">
                                <div class="content">
                                    <p>
                                        <strong>사용자 이름</strong>
                                        <br>
                                        댓글 내용 Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus nec
                                        iaculis mauris.
                                        <br>
                                        <small>작성일: 2024-03-19</small>
                                    </p>
                                </div>
                            </div>
                        </article>
                        <article class="media">
                            <div class="media-content">
                                <div class="content">
                                    <p>
                                        <strong>사용자 이름</strong>
                                        <br>
                                        댓글 내용 Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus nec
                                        iaculis mauris.
                                        <br>
                                        <small>작성일: 2024-03-19</small>
                                    </p>
                                </div>
                            </div>
                        </article>
                    </div>
                </div>
                <div>
                    <textarea style="min-height: 4em; border: 0; margin-top: 1em;" class="textarea is-success"
                        placeholder="댓글 내용을 입력해주세요"></textarea>
                    <button class="is-fullwidth button is-info mb-1"">댓글 등록</button>
                </div>
            </section>
        </div>

    </div>
</body>

</html>